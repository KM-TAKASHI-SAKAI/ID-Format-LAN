<!DOCTYPE html>
<html lang="ja">
<meta charset="UTF-8">

<head>
  <title>SONIMAGE HS1</title>
  <base href="http://192.168.20.180:8123/">
  <style>
  input {
    font-size:35px;
    margin:5px;
    height:40px;
  }
  </style>
</head>

<body bgcolor="#303030" text="#cccccc" onmousedown="preventFocus(event);">
  <p>
    装置番号
    <input type="number" id="bus_id" min="0" max="99" value='' style="width:80px" oninput="CreatePatientID();">
  </p>
  <p>
    受付番号
    <input type="number" id="input_id" min="0" max="99999" value='' style="width:150px;" oninput="CreatePatientID();">
    <input type="button" id="clear_id" value="×" onmousedown="preventFocus();" style="width:50px;" onclick="input_id.value='';CreatePatientID();" tabindex="-1">
  </p>
  <p>
    <form method="get" name="input_form" action="http://192.168.1.39:8123/hs1/" target="hidenframe">
      <input type="submit" id="abd_btn" value="腹部" onmousedown="preventFocus();" style="width:80px; height:70px; font-size:27px; background-color:deepskyblue;" tabindex="-1">
      <input type="text" name="id" id="abd_id" style="width:230px;background-color:#303030;color:#C0C0C0;font-size:25px;" oninput="CreatePatientID();" tabindex="-1">
    </form>

    <form method="get" name="input_form" action="http://192.168.1.39:8123/hs1/" target="hidenframe">
      <input type="submit" id="brest_btn" value="乳腺" onmousedown="preventFocus();" style="width:80px; height:70px;font-size:27px;background-color:lightcoral;" tabindex="-1">
      <input type="text" name="id" id="brest_id" style="width:230px;background-color:#303030;color:#C0C0C0;font-size:25px; oninput="CreatePatientID();" tabindex="-1">
    </form>

    <form method="get" name="input_form" action="http://192.168.1.39:8123/hs1/" target="hidenframe">
      <p>
        手動入力
      </p>
      <p>
        <input type="text" name="id" id="manual_id" style="width:230px;font-size:25px;">
        <input type="submit" value="送信" onmousedown="preventFocus();" style="width:80px; height:70px;font-size:27px;" tabindex="-1">
      </p>          
    </form>
    <HR>
    IP Address <input type="text" id="ip_address" oninput="CreatePatientID();" style="font-size:16px;">

  </p>

  <script>
  function preventFocus(e) {
    if( e && (e.srcElement.id == "bus_id" ||  e.srcElement.id == "input_id" ||  e.srcElement.id == "manual_id" ||  e.srcElement.id == "ip_address"))
    {
      e.stopPropagation();
    }
    else
    {
      var ae = document.activeElement;
      setTimeout(function() { ae.focus() }, 1);
    }
  }
  function CreatePatientID() {
    // input要素を取得
    var bus_id = document.getElementById("bus_id");
    var input_id = document.getElementById("input_id");
    var abd_id = document.getElementById("abd_id");
    var brest_id = document.getElementById("brest_id");
    var manual_id = document.getElementById("manual_id");
    var ip_address = document.getElementById("ip_address");
    var forms = document.getElementsByName("input_form");
    for(var i = 0; i < forms.length; i++){
      forms[i].action = "http://"+ip_address.value+":8123/hs1/";
    }
    var today = new Date();
    var dd = String(today.getDate()).padStart(2, '0');
    var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
    var yy = today.getFullYear()%100;
    today = yy+mm+dd;
    bus_id.value = ( '00' + bus_id.value ).slice( -2 );
    input_id.value = ( '00000' + input_id.value ).slice( -5 );
    abd_id.value = today + 'A' +( '00' + bus_id.value ).slice( -2 )+'-'+( '00000' + input_id.value ).slice( -5 );
    brest_id.value = today + 'B' +( '00000' + input_id.value ).slice( -2 )+'-'+( '00000' + input_id.value ).slice( -5 );
    localStorage.setItem('bus_id', bus_id.value);
    localStorage.setItem('ip_address', ip_address.value);
  }
  window.onload = function() {
    var input_id = document.getElementById("input_id");
    input_id.focus();

    var bus_id = document.getElementById("bus_id");
    var ip_address = document.getElementById("ip_address");

    if(localStorage.getItem('bus_id')) {
      bus_id.value = localStorage.getItem('bus_id');
    }
    if(localStorage.getItem('ip_address')) {
      ip_address.value = localStorage.getItem('ip_address');
    }
    CreatePatientID();
  }
  </Script>
  <iframe name="hidenframe" style="display:none"></iframe>
</body>
</html>
